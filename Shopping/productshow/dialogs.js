define(["jquery","Keeper"],function(a,b){a.fn.Dialogs=a.Dialogs=function(b){return this instanceof a?this.each(function(){b.$d=a(this),new c.M(b)}):new c.M(b)};var c={ver:"3.0"};c.M=function(c){var d=this;d.$=c.$d||!1,d.$window=a(window),d.$document=a(document),d.$body=a(document.body),d.docHeight=d.$document.height(),d.scrollHeight=d.$document.scrollTop(),d.bodyHeight=d.$body.height(),d.auto="boolean"==a.type(c.auto)?c.auto:!0,d.times="number"==a.type(c.times)?c.times:5,d.openfun=c.openfun||new Function,d.closefun=c.closefun||new Function,d.parameter=c.parameter||[],d.offset=c.offset||!1,d.lock="boolean"==a.type(c.lock)?c.lock:!!d.$,d.closebtn=c.closebtn,d.closeAll="boolean"==a.type(c.classAll)?c.classAll:!1,d.id=c.id||"diglog_wrapper",d.cls=c.cls||"",d.css=c.css||{},d.diglogWrapper='<div id="'+d.id+'" class="dialog-wrapper"></div>',d.overlay="boolean"===a.type(c.overlay)?c.overlay:"object"===a.type(c.overlay)?c.overlay:!1,d.msgbody=c.msbbody||'{{#close}}<div class="diginfo">{{#msg}}</div>',d.tpl=c.tpl||{},d.msg=c.msg||"",d.close=("boolean"==a.type(c.close)?c.close:!0)?'<a href="javascript:void(0)" title="关闭窗口"><span class="close"></span></a>':"",d.diginfo=b.ParseTpl(d.msgbody,a.extend({},d.tpl,{close:d.close,msg:d.msg})),d.openRet=!1,d.closeRet=!1,d.Init(c),d.Overlay(),d.autoClose()},c.M.prototype={fixIeH5:function(a,b){return window.html5&&!html5.supportsUnknownElements?html5.fix(a,b):a},Init:function(){var b=this;if(a("#"+b.id).length>0&&a("#"+b.id).remove(),a(b.diglogWrapper).html(b.fixIeH5(b.diginfo)).appendTo(b.$body),b.$d=a("#"+b.id),b.$d.addClass(b.cls),b.$d.css(b.css),!b.overlay&&"msie"==a.browser.name&&"6.0"==a.browser.version){var c=a('<iframe frameborder="0"></iframe>');c.css({width:"100%",visibility:"inherit",height:b.$d.find(".diginfo").height()-10,position:"absolute",overflow:"hidden",left:0,top:0,"z-index":-1}).prependTo(b.$d)}try{b.openRet=b.openfun.apply(this,b.parameter)}catch(d){console.info(d)}b.closeBtn="boolean"==a.type(b.closebtn)&&0==b.closebtn?b.$d.find("a .close").hide():b.$d.find("string"===a.type(b.closebtn)?b.closebtn:"a .close"),b.closeBtn.bind("click",function(){try{b.closeRet=b.closefun.apply(this,b.parameter)}catch(c){window.console&&console.info(c)}return 0!=b.$d.length&&b.$d.remove(),b.closeAll&&(a(".diglog-wrapper,.dialog-overlay").remove(),a.each(b.cls.split(" "),function(b,c){a("."+c).remove()})),0!==a(".dialog-overlay").length&&"yes"==b.$d.prop("overlay")&&a(".dialog-overlay").remove(),a(window).unbind("resize.dialog"+b.id),!1}),b.Position()},Overlay:function(b){var c=this;if(c.overlay&&0==a(".dialog-overlay").length){var d={background:"#000",width:"100%",height:c.docHeight,opacity:.5,position:"absolute",overflow:"hidden",left:0,top:0},e=a('<div class="dialog-overlay"></div>');if(c.overlay.cls&&e.addClass(c.overlay.cls),c.overlay.css&&(d=a.extend(d,c.overlay.css)),e.css(d).css("z-index",c.$d.css("zIndex")-1),c.$body.append(e),c.$d.prop("overlay","yes"),"msie"==a.browser.name&&"6.0"==a.browser.version){var f=a('<iframe frameborder="0"></iframe>');f.css({width:"100%",visibility:"inherit",height:c.docHeight,position:"absolute",overflow:"hidden",left:0,top:0}).css("z-index",c.$d.css("zIndex")-2),e.append(f)}}},Position:function(b){var c=this;c.w=c.offset.width||c.$d.width(),c.h=c.offset.height||c.$d.height();var d=function(){var b={};return c.$?(b.top=c.offset.top?c.$.offset().top+c.offset.top:c.$.offset().top+c.$.height(),b.left=c.offset.left?c.$.offset().left+c.offset.left:c.$.offset().left):(b.top=parseInt(c.$window.height()-c.h)/2+c.scrollHeight,b.top=b.top>0?b.top:0,b.left=parseInt(c.$window.width()-c.w)/2),c.offset&&(b=a.extend(!0,{},c.offset,b)),b},e=d();c.lock&&a(window).bind("resize.dialog"+c.id,function(){c.$d.css(d())}),c.$d.css(e)},autoClose:function(c,d){var e=this,c=c||e.times,d=d||e.auto;d&&(b.getTime.countTimer[e.id]=window.setTimeout(function(){e.$d.fadeOut("slow",function(){a(this).find("span.close").trigger("click")})},1e3*c))}}});