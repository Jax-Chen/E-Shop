Function.prototype.bindFunc=function(a){if("object"!=typeof a)return!1;var b=this;return function(){return b.apply(a,arguments)}};var ssoUrl="",logout_status="",renew_status="",PassportCardList=[];define(["jquery","base64","Keeper"],function($,Base64,K){var PassportSC={version:2,ppsid:"pp18610_v1.0 @wangqian ",appid:9999,max_line_length:30,domain:"",lastLogin:!1,myDomainView:!1,cookie:!1,username:"",bindDomainSelector:!0,autopad:"",autoRedirectUrl:"",loginRedirectUrl:"",logoutRedirectUrl:"",selectorTitle:"请选择您的用户帐号类型",registerUrl:"https://passport.tuan800.com/users/signup",recoverUrl:"https://passport.tuan800.com/users/password/index",postru:"",emailPostfix:!1,curDSindex:-1,usePost:0,successCalledFunc:!1,curCardIndex:0,rootElement:!1,dsElement:!1,sElement:!1,cElement:!1,dsAnchor:!1,usernameInput:!1,passwdInput:!1,pcInput:!1,loginMsg:!1,iElement:!1,isSetFocus:!0,md5pwd:!1,captcha_url:"//acode.tuanimg.com/captcha/get_image?jsonp=1&callback=?",captcha_check:window.login_need_captcha||!1,loginProtocal:"https",loginURL:"PASSPORT.TUAN800.COM/sso/login",logoutURL:"PASSPORT.TUAN800.COM/sso/logout",vurl:"https://PASSPORT.TUAN800.COM/sso/scripts?type=",http_url:!1,login_urltpl:"{{#http}}://{{#url}}?username={{#username}}&password={{#pwd_md5}}&appid={{#appid}}&rememberme={{#pc}}&s={{#s}}&b={{#b}}&w={{#w}}&pwdtype=1&v={{#version}}",logins_urltpl:"{{#http}}://{{#url}}?username={{#username}}&password={{#pwd_md5}}&appid={{#appid}}&rememberme={{#pc}}&s={{#s}}&b={{#b}}&w={{#w}}&pwdtype=2&v={{#version}}",login_expms:"",logout_expms:"",logoutp_urltpl:"{{#http}}://{{#url}}?s={{#s}}&ru={{#ru}}",logout_urltpl:"{{#http}}://{{#url}}?appid={{#appid}}",eInterval:!1,maxIntervalCount:70,intervalCount:0,defualtRemPwd:"",isShowRemPwdMsg:0,campImg:"",campImgAlt:"",campUrl:"https://passport.tuan800.com/profile/index",cardTitle:"",firstDomain:"keyinfo",confirmInfo:"浏览器将保持通行证的登录状态，网吧或公共机房上网者请慎用。您能确认本次操作吗？",waitInfo:"正在登录通行证，请稍候...",returnTo:"",defaultApp:"",domainPool:["tuan800.com","zhe800.com","hui800.com"],domainList:["keyinfo","163.com","qq.com","hotmail.com","gmail.com","139.cn","189.cn"],appList:{1000:"tuan800",2000:"zhe800",3000:"hui800"},appName:{tuan800:"团800",zhe800:"折800",hui800:"惠800"},appUrl:{tuan800:"http://www.tuan800.com",zhe800:"http://www.zhe800.com",hui800:"http://www.hui800.com"},appPool:!1,bottomRow:[],recomServ:[],reverseFirstDomain:!1,showEmailInputTip:!0,usePostFix:!0,gotohref:function(a,b){window.href=a,$("body").append($("<a>").attr("href",a).bind("click",function(){window.location=$(this).attr("href")}).trigger("click"))},getCaptcha:function(a){$.ajax(this.captcha_url,{type:"GET",cache:!1,dataType:"jsonp",jsonpCallback:"jsonp_callback",success:function(b){login_error_result=login_error_result||{},login_error_result.captcha_keywords=b.keywords,login_error_result.captcha_img=b.url,a(!0)},error:function(){login_error_result=login_error_result||{},login_error_result.captcha_keywords="",login_error_result.captcha_img="",a(!1)},complete:function(a,b){}})},getDomain:function(){var a=document.domain.split("."),b=a.length;return 2>=b?document.domain:a[b-2]+"."+a[b-1]},getPassportDomain:function(){return""},preventEvent:function(a){a.cancelBubble=!0,a.returnValue=!1,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation()},getTime:function(){var a=new Date;return a.getTime()},reportMsg:function(a,b,c){var d="";switch(a){case"1":d+="<em></em>请输入通行证用户名";break;case"2":d+="<em></em>通行证用户名为邮件地址格式";break;case"3":d+="<em></em>用户名后缀必须为"+arguments[1];break;case"4":d+=window.login_with_mobile?"<em></em>请输入动态密码":"<em></em>请输入通行证密码";break;case"5":d+="<em></em>请输入图片验证码";break;case"6":d+="<em></em>登录超时，请稍后重试";break;case"7":d+="<em></em>登录失败，请重试";break;case"8":d+="<em></em>网络故障，退出失败，请重新退出";break;case"9":d+="<em></em>用户名或密码错误，请重试";break;case"10":d+="<em></em>暂时不可登录，请稍后重试";break;case"11":d+="<em></em>浏览器设置有误，请查看帮助修正";break;case"12":d+="<em></em>账号尚未激活，重发<a href="+this.loginProtocal+'"://passport.tuan800.com/users/confirmation/new?email='+this.usernameInput.val()+'" target="_blank">激活邮件</a>';break;case"13":d+="<em></em>手机号未注册，请<a href="+this.loginProtocal+'" ://">注册折800账号</a>';break;case"error":d="<em></em>"+b.message;break;default:d+="<em></em>登录错误，请稍后重试"}this.showMsg(d)},showMsg:function(a){this.loginMsg&&this.loginMsg.html(a).show()},cookieHandle:function(){return this.cookie||this.parsePassportCookie(),this.cookie&&""!=this.cookie.userid?this.cookie.userid:""},getDisplayName:function(){var a=this.cookieHandle(),b=a.split("@"),c=b[0],d=/^1\d{10}$/;return d.test(c)?c.substring(0,3)+"****"+c.substring(7):a},parsePassportCookie:function(){var a="";if(""!=K.cookie("ppinf")&&(a=unescape(K.cookie("ppinf"))),""===a)return void(this.cookie=!1);try{var b=a.split("|"),c=Base64.decode(b[3]);this._parsePassportCookie(c)}catch(d){window.console&&console.info(d)}},_parsePassportCookie:function(a){var b=this,c=$.parseJSON(a);this.cookie=new Object,$.each(c,function(a,c){b.cookie[a]=c});try{this.cookie.service=new Object;var d=this.cookie.service;d.tuan800=1,d.zhe800=1,d.hui800=1}catch(e){window.console&&console.info(e)}},parseAppid:function(){var a=this.appid.toString(),b=0;this.appPool=new Array;for(var c in this.appList){var d=this.appList[c];"string"==typeof d&&(c==a?this.defaultApp=this.appName[d]:(this.appPool[b]={app:d,name:this.appName[d],url:this.appUrl[d]},b++))}},getBottomRow:function(){var a=0,b=this.max_line_length-Keeper.getStringLen(this.defaultApp);this.bottomRow[0]=new Array,this.bottomRow[1]=new Array,this.cookie&&(a=this._getBottomRow(this.bottomRow[0],b,0),b=this.max_line_length,a=this._getBottomRow(this.bottomRow[1],b,a))},_getBottomRow:function(a,b,c){var d,e,f,g=this.cookie.service,h=this.appPool,i=c;for(e=0;i<h.length;i++)if(d=h[i].app,0!=i&&1!=i){if("undefined"!=typeof g[d])if(0!=g[d]){if(f=Keeper.getStringLen(h[i].name),0>b-f)break;b-=f+2,a[e]=h[i],e++}else{var j=this.recomServ.length;this.recomServ[j]=h[i]}}else{if(f=Keeper.getStringLen(h[i].name),0>b-f)break;b-=f+2,a[e]=h[i],e++}return i},parseLastDomain:function(a){this.emailPostfix=new Array;var b="",c="",d=0;if(""!=this.firstDomain){for(var e in a)if(this.firstDomain==a[e]){c=a[e];break}""!=c&&(this.emailPostfix[d]=c,d++)}for(var e in a)"string"==typeof a[e]&&a[e]!=this.domain&&a[e]!=b&&a[e]!=c&&(this.emailPostfix[d]=a[e],d++)},doPost:function(){for(var a=0;a<document.forms.length&&"loginform"!=document.forms[a].name;a++);if(a==document.forms.length)return document.location.href=this.loginProtocal+"://passport.tuan800.com",!1;var b={url:"passport.tuan800.com/login",appid:this.appid,ru:this.postru,b:c,w:d,version:this.version},c=getBrowserType(),d=screen.width;return document.forms[a].action=K.ParseTpl("{{#url}}?appid={{#appid}}&ru={{#ru}}&b={{#b}}&w={{#w}}&v={{#version}}",b),document.forms[a].submit(),!1},doLogin:function(){if(!this.eInterval){arguments[0]&&PassportCardList[index].doLogin(),this.intervalCount=0,this.sElement.empty(),this.username=$.trim(this.usernameInput.val());var a=this.username,b=$.trim(this.passwdInput.val()),c=$.trim(this.captchaInput?this.captchaInput.val():!1),d=0;if(this.pcInput&&1==this.pcInput.prop("checked")&&(d=1),""==a)return this.reportMsg("1"),this.usernameInput.focus(),!1;if(""!=this.autopad){var e=email.substr(email.lastIndexOf("@")+1);if(this.autopad.lastIndexOf(e)<0)return this.reportMsg("3",this.autopad),this.usernameInput.focus(),this.passwdInput.value="",!1}return""==b?(this.reportMsg("4"),this.passwdInput.value="",this.passwdInput.focus(),!1):!window.login_with_mobile&&this.captcha_check&&""==c?(this.reportMsg("5"),!1):1==this.usePost?(login_status="",login_error_result="",login_need_captcha=!1,this.doPost()):(this.drawPassportWait(this.waitInfo),this.loginHandle(a,b,d,this.sElement,this.loginFailCall.bindFunc(this),this.loginSuccessCall.bindFunc(this)))}},loginHandle:function(a,b,c,d,e,f){if("object"!=typeof d)return!1;if(0==K.cookie())return e(),!1;var g=$.getBrowserType(),h=screen.width;""==this.domain&&(this.domain=this.getDomain());var i=this.getTime(),j=this.md5pwd?function(){return $.md5?$.md5(b):b}:b,k={http:this.loginProtocal,url:this.loginURL,username:encodeURIComponent(a),pwd_md5:encodeURIComponent(j),appid:this.appid,pc:c,s:i,b:g,w:h,version:this.version},l=this.login_urltpl;try{"https"==this.loginProtocal&&(l=this.logins_urltpl),this.http_url=K.ParseTpl(l,k);var m=this.http_url}catch(n){"https"==this.loginProtocal&&(l=this.https_urltpl),this.http_url=K.ParseTpl(l,k);var m=this.http_url;window.console&&console.info(n)}m+="&domain="+this.domain,""!=this.returnTo&&(m+="&return_to="+this.returnTo),window.login_with_mobile&&(m+="&sms_dynamic_login=true"),this.captchaInput&&""!=this.captchaInput.val()&&(m+="&captcha="+this.captchaInput.val()+"&captcha_keywords="+login_error_result.captcha_keywords),m+=this.login_expms,login_status="",login_error_result="",login_need_captcha=!1,$.getScript(m,!0);var o=this;return this.eInterval=setInterval(function(){o.loginIntervalProc(e,f,d)},100),!1},loginIntervalProc:function(a,b,c){return""==login_status&&this.intervalCount<this.maxIntervalCount?void this.intervalCount++:(clearInterval(this.eInterval),this.eInterval=!1,"success"!=login_status||this.intervalCount>=this.maxIntervalCount?void("https"==this.loginProtocal&&""==login_status?this.intervalCount=0:a()):(""==this.loginRedirectUrl?this.autoProcAllDomain("login",c):K.cookie("crossdomain",this.getTime(),{path:"/",expires:336}),void b()))},loginFailCall:function(){this.sElement.html(""),this.drawLoginForm();var a=login_status;if(this.intervalCount>=this.maxIntervalCount)this.reportMsg("6"),this.usernameInput.focus();else{if(0!=K.cookie()){if(this.reportMsg(a,login_error_result,login_need_captcha),!window.login_with_mobile&&login_need_captcha&&this.captchaInput){var b=this,c=function(a){var c=a;b.getCaptcha(function(a){c.attr("src",login_error_result.captcha_img)})};this.captchaInput.closest(".token").show().find("img").unbind("click").bind("click",function(){c($(this))})}return this.passwdInput.focus(),!1}this.reportMsg("11"),this.usernameInput.focus()}},loginSuccessCall:function(){if(this.parsePassportCookie(),this.cookie&&""!=this.cookie.username){if(this.username="",""!=this.loginRedirectUrl)document.location.href==this.loginRedirectUrl?document.location.reload():PassportSC.gotohref(this.loginRedirectUrl);else for(this.getBottomRow(),this.drawPassportCard(),i=0;i<PassportCardList.length;i++)i!=this.curCardIndex&&(PassportCardList[i].parsePassportCookie(),PassportCardList[i].getBottomRow(),PassportCardList[i].drawPassportCard());try{this.loginApp()}catch(a){window.console&&console.info(a)}}else this.drawLoginForm(),this.reportMsg("7")},doLogout:function(){this.eInterval||(this.intervalCount=0,this.sElement.html(""),1==this.usePost?window.location=K.ParseTpl(this.logoutp_urltpl,{http:this.loginProtocal,url:this.logoutURL,s:this.getTime(),ru:this.postru}):this.logoutHandle(this.sElement,this.logoutFailCall.bindFunc(this),this.logoutSuccessCall.bindFunc(this,"dd")))},logoutHandle:function(a,b,c){if("object"!=typeof a)return!1;logout_status="",""==this.domain&&(this.domain=this.getDomain());var d=(this.getTime(),K.ParseTpl(this.logout_urltpl,{http:this.loginProtocal,url:this.logoutURL,appid:this.appid}));d+="&domain="+this.domain,$.getScript(d);var e=this;this.eInterval=setInterval(function(){e.logoutIntervalProc(b,c,a)},100)},logoutIntervalProc:function(a,b,c){return""==logout_status&&this.intervalCount<this.maxIntervalCount?void this.intervalCount++:(clearInterval(this.eInterval),this.eInterval=!1,"success"!=logout_status||this.intervalCount>=this.maxIntervalCount?void a():(""==this.logoutRedirectUrl?this.autoProcAllDomain("logout",c):K.cookie("crossdomain_logout",this.getTime(),{path:"/",expires:336}),void b()))},logoutFailCall:function(){this.sElement.html(""),this.reportMsg("8")},logoutSuccessCall:function(a){if(this.parseLastDomain(this.domainList),this.cookie=!1,this.drawLoginForm(),""!=this.logoutRedirectUrl)document.location.href==this.logoutRedirectUrl?document.location.reload():PassportSC.gotohref(this.logoutRedirectUrl);else for(i=0;i<PassportCardList.length;i++)i!=this.curCardIndex&&PassportCardList[i].drawLoginForm();try{this.logoutApp()}catch(b){window.console&&console.info(b)}},refreshCookie:function(a,b,c){var d=this.loginProtocal+"://passport.tuan800.com/sso/refresh?_t="+(new Date).getTime();if(d){var e=$("<iframe></iframe>");e.css({height:0,width:0}).attr("src",d),$("body").append(e)}return!1},renewCookie:function(a,b,c){if("object"!=typeof a)return!1;""==this.domain&&(this.domain=this.getDomain());var d=this.getTime(),e=this.loginProtocal+"://passport.tuan800.com/sso/refresh?ra"+d;if(e+="&domain="+this.domain){var f=$("<iframe></iframe>");f.css({height:0,width:0}).attr("src",vurl),a.append(f)}$.getScript(e);var g=this;return this.eInterval=setInterval(function(){g.renewIntervalProc(b,c,a)},100),!1},renewIntervalProc:function(a,b,c){if(""==renew_status&&this.intervalCount<this.maxIntervalCount)return void this.intervalCount++;if(clearInterval(this.eInterval),this.eInterval=!1,"success"!=renew_status||this.intervalCount>=this.maxIntervalCount)try{a()}catch(d){window.console&&console.info(d)}else{this.autoProcAllDomain("renew",c);try{b()}catch(d){window.console&&console.info(d)}}},autoProcAllDomain:function(a,b){var c=this.crossDomainIframeUrl(a);if(c){var d=$("<iframe></iframe>");d.css({height:0,width:0}).attr("src",c),$("body").append(d)}},doCrossDomainCookie:function(a,b){var c=this;if("object"==typeof a){var d="crossdomain";"logout"==b&&(d="crossdomain_logout"),""==this.domain&&(this.domain=this.getDomain());var e=K.cookie(d),f=K.cookie("ppinf"),g=K.cookie("ppinf_lastTime"),h="ppinf_lastTime",i=function(){var b=$("<iframe></iframe>");b.css({height:0,width:0}).attr("src",c.loginProtocal+"://passport.tuan800.com/sso/refresh?_t"+(new Date).getTime()),a.append(b)};if(""!=e&&"0"!=e){var j=this.crossDomainIframeUrl(b);if(j){var k=$("<iframe></iframe>");k.css({height:0,width:0}).attr("src",j),a.append(k),K.cookie(d,"",{path:"/",domain:"."+this.domain,expires:new Date(0)}),K.cookie(d,"",{path:"/",expires:new Date(0)})}}else if(""==f&&"logout"==b&&""!=g)K.cookie(h,"",{path:"/",domain:"."+this.domain,expires:new Date(0)});else if(""!=f&&"login"==b){var l,m,n=parseInt(K.cookie("ppinf").split("|")[1]);if(l=new Date(n),""==g)l.setDate(l.getDate()+1),K.cookie(h,n,{path:"/",domain:"."+this.domain,expires:l}),i();else{var m=new Date(parseInt(g));l.setHours(0,0,0),m.setHours(0,0,0);var o=Math.floor((Date.parse(l)-Date.parse(m))/24/1e3/3600);o>0&&(i(),K.cookie(h,(new Date).getTime(),{path:"/",domain:"."+this.domain,expires:n}))}}}},crossDomainUrl:function(a,b){var c=this.getTime(),d=this.loginProtocal+"://passport.tuan800.com/sso/scripts?s="+c+"&type="+a+"&current_site="+b;return d},crossDomainIframeUrl:function(a){var b=this.vurl+a+"&domain="+this.domain;return b},setDomainCookie:function(a,b,c,d){login_status="",login_error_result="",login_need_captcha=!1,crossdomain_status="";var e=this.crossDomainUrl("login",b);e&&$.getScript(e);var f=this;this.eInterval=setInterval(function(){f.setCookieIntervalProc(a,c,d)},100)},setCookieIntervalProc:function(a,b,c){return""!=crossdomain_status?(clearInterval(this.eInterval),this.eInterval=!1,void c()):""==login_status&&this.intervalCount<this.maxIntervalCount?void this.intervalCount++:(clearInterval(this.eInterval),this.eInterval=!1,"success"!=login_status||this.intervalCount>=this.maxIntervalCount?void c():void b())},downDSindex:function(){var a=this.dsAnchor.find("tr");if(0!=a.size()){var b=0,c=this.curDSindex;a.each(function(a){return $(this).find("td:first").prop("idx")==c?(b=a,!1):void 0}),b>=a.size()-1?this.curDSindex=a.eq(0).find("td:first").prop("idx"):this.curDSindex=a.eq(b+1).find("td:first").prop("idx")}},upDSindex:function(){var a=this.dsAnchor.find("tr");if(0!=a.size()){var b=-1,c=0,d=this.curDSindex;a.each(function(e){return $(this).find("td:first").prop("idx")==d?(c=e,!1):void(b=a.eq(e).find("td:first").prop("idx"))}),c==a.size()?this.curDSindex=a.eq(0).find("td:first").prop("idx"):-1==b?this.curDSindex=a.eq(a.size()-1).find("td:first").prop("idx"):this.curDSindex=b}},findDSindex:function(a){try{var b=this.dsAnchor.find("tr"),c="";return b.each(function(){return $(this).find("td:first").prop("idx")==a?(c=$(this).find("td:first"),!1):void 0}),c}catch(d){window.console&&console.info(d)}return!1},clearFocus:function(a){"number"!=typeof a&&(a=this.curDSindex);try{var b=this.findDSindex(a);b.removeClass().css("font-weight","normal")}catch(c){window.console&&console.info(c)}},setFocus:function(a){"number"!=typeof a&&(a=this.curDSindex);try{var b=this.findDSindex(a);b.removeClass().addClass("active")}catch(c){window.console&&console.info(c)}},fillEmailSelect:function(){var a=this.usernameInput.val();if(!this.dsElement)return!1;if(""==a)return this.dsElement.hide(),void this.dsAnchor.empty();var b=this,c="",d='<tr><td id="email_postfix_{{#id}}">{{#usePostFix}}</td></tr>',e="",f="",g=a.lastIndexOf("@");0>g?f=a:g==a.length-1?f=a.substr(0,g):(f=a.substr(0,g),e=a.substr(g+1));var h=parseInt(this.usernameInput.offset().left-this.cElement.offset().left);$.browser.msie,this.dsElement.css("margin-left",h+"px"),this.dsElement.css("margin-top",this.usernameInput.offset().top-this.cElement.offset().top+this.usernameInput.get(0).offsetHeight-1+"px"),this.dsElement.css({"z-index":999999,padding:0,"background-color":"white"}),this.dsAnchor.empty().append('<table width="100%" cellspaceing="0" cellpadding="3"><tbody></tbody></table>');var i=this.dsAnchor.find("tbody:first"),j=0,k=!1,l=!1,m=-1,n=this.emailPostfix,o=/^1.*$/;o.test(a)&&(n=""!=this.autopad?["mobile",this.autopad]:["mobile"]);for(var p=0;p<n.length;p++){var q=n[p];"string"==typeof q&&(""!=e&&0!=q.lastIndexOf(e)||(j++,-1==m&&(m=p),this.curDSindex==p&&(k=!0),"keyinfo"==q||"mobile"==q?c=a:0==l?c=this.usePostFix?f+"@"+q:f:this.usePostFix?c=q:usePostFixL=q.substring(0,q.lastIndexOf("@")),code=$(K.ParseTpl(d,{id:p,usePostFix:c})),code.find("td:first").prop("idx",p).bind("mouseover",function(){b.clearFocus(),b.curDSindex=this.idx,b.setFocus(),this.style.cursor="pointer"}).bind("click",b.doSelect),i.append(code),l=!1))}j>0?(this.dsElement.show(),0==k&&(this.curDSindex=m),this.setFocus()):(this.dsElement.hide(),this.curDSindex=-1)},doSelect:function(){if(!this.dsElement)return!1;this.dsElement.hide();var a=this.findDSindex(this.curDSindex);if(a){var b=a.html();b&&this.usernameInput.val(b.replace(/&amp;/g,"&"))}""!=this.usernameInput.val()&&this.passwdInput.focus()},checkKeyDown:function(a){a=a||window.event;var b=a.keyCode||a.which||a.charCode;if(38==b||40==b){if(1==a.shiftKey)return;this.clearFocus(),38==b?this.upDSindex():40==b&&this.downDSindex(),this.setFocus()}},checkKeyPress:function(a){a=a||window.event;var b=a.keyCode||a.which||a.charCode;if(13==b)this.preventEvent(a);else if(38==b||40==b){if(1==a.shiftKey)return;this.preventEvent(a),this.clearFocus(),38==b?this.upDSindex():40==b&&this.downDSindex(),this.setFocus()}else if(108==b||110==b||111==b||115==b){var c=this;setTimeout(function(){c.fillEmailSelect()},10)}},checkKeyUp:function(a){a=a||window.event;var b=a.keyCode||a.which||a.charCode;if(this.fillEmailSelect(),13==b&&this.doSelect(),!(7!=$.getBrowserType()&&4!=$.getBrowserType()||38!=b&&40!=b)){if(1==a.shiftKey)return;this.clearFocus(),38==b?this.upDSindex():40==b&&this.downDSindex(),this.setFocus()}},checkMousedown:function(){return"通行证帐号/手机号"==this.usernameInput.val()?(this.usernameInput.val(""),void this.usernameInput.focus()):void 0},rootElement:function(a){this.rootElement=a,this.rootElement.html('<div class="ppselecter" style="position: absolute; display: none;"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td style="" class="ppseltit">'+this.selectorTitle+'</td></tr><tr><td /></tr></tbody></table></div><div style="display: none;"></div><div class="passportc"></div>'),null!=this.selectorTitle&&0!=this.selectorTitle.length||this.rootElement.html('<div class="ppselecter" style="position: absolute; display: none;"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr></tr><tr><td height="0" /></tr><tr><td /></tr></tbody></table></div><div style="display: none;"></div><div class="passportc"></div>');var b=this.rootElement.find("div");this.dsElement=b.eq(0),this.dsAnchor=this.dsElement.find("td:last"),this.sElement=b.eq(1),this.cElement=b.eq(2)},init:function(a){this.rootElement(a),this.domain=this.getDomain(),this.parseLastDomain(this.domainList),this.parseAppid(),this.parsePassportCookie(),this.getBottomRow(),""==this.postru&&(this.postru=document.location.href)},_drawPassportCard:function(){},drawPassportCard:function(){this._drawPassportCard(),this.$iElement();try{this.successCalledFunc(this.iElement)}catch(a){this.drawPassportInfo(),window.console&&console.info(a)}},$iElement:function(){this.iElement=this.cElement.find(".listContA")},drawPassportWait:function(a){},drawPassportInfo:function(){},getRanServ:function(){var a=this.recomServ.length;if(0==a)return"";var b=Math.floor(a*Math.random()),c='<a href="'+this.recomServ[b].url+'" target="_blank">'+this.recomServ[b].name+"</a>";if(1==a)return c;for(var d=Math.floor(a*Math.random());b==d;)d=Math.floor(a*Math.random());return c+=' | <a href="'+this.recomServ[d].url+'" target="_blank">'+this.recomServ[d].name+"</a>"},_drawLoginForm:function(){},drawLoginForm:function(){this._drawLoginForm();var a=this.cElement.find("input"),b=this;b.captchaInput=!1,a.each(function(){"username"==$(this).attr("name")&&(b.usernameInput=$(this)),"password"==$(this).attr("name")&&(b.passwdInput=$(this)),"remember_me"==$(this).attr("name")&&(b.pcInput=$(this)),"captcha"==$(this).attr("name")&&(b.captchaInput=$(this))}),this.loginMsg=this.cElement.find(".error"),0==this.isShowRemPwdMsg&&this.pcInput&&this.pcInput.bind("click",function(){if(0!=b.pcInput.prop("checked")){var a=window.confirm(b.confirmInfo);0==a&&b.pcInput.attr("checked",!1)}}),this.bindSelector(),this.autoFillUserId();var b=this;if(""==this.usernameInput.val()?this.isSetFocus&&setTimeout(function(){b.usernameInput.focus()},50):this.isSetFocus&&"通行证帐号/手机号"!=this.usernameInput.val()&&setTimeout(function(){b.passwdInput.focus()},50),!window.login_with_mobile&&login_need_captcha&&this.captchaInput){var b=this,c=function(a){var c=a;b.getCaptcha(function(a){c.attr("src",login_error_result.captcha_img)})};this.captchaInput.closest(".token").show().find("img").unbind("click").bind("click",function(){c($(this))})}},autoFillUserId:function(){if(this.showEmailInputTip)return void(this.showEmailInputTip=!1);var a=K.cookie("pptmpuserid");if(this.username.length>0?this.usernameInput.val(this.username):this.usernameInput.val(a),a.length>0){setTimeout(function(){K.cookie("pptmpuserid",this.getTime(),{path:"/",expires:new Date(0)})},1e3)}},bindSelector:function(){this.bindDomainSelector&&(this.curDSindex=-1,this.usernameInput.bind("mousedown",this.checkMousedown.bindFunc(this)).bind("keypress",this.checkKeyPress.bindFunc(this)).bind("keyup",this.checkKeyUp.bindFunc(this)).bind("blur",this.doSelect.bindFunc(this)),$.browser.msie&&this.usernameInput.bind("keydown",this.checkKeyDown.bindFunc(this)))},drawPassport:function(element){var self=this;if("string"==$.type(element)){if(element=$("#"+element),0==element.size())return!1}else{if("object"!=$.type(element))return;element=$(element)}if(this.md5pwd&&$.getScript("http://passport.tuan800.com/js/jquery.md5.min.js",!0),0==PassportCardList.length&&(PassportCardList[0]=this),!this.successCalledFunc)try{this.successCalledFunc=eval("drawAppInfo")}catch(e){this.successCalledFunc=this.drawPassportInfo}if(this.init(element),this.cookie&&""!=this.cookie.username){if(""!=this.autopad){var userid=this.cookie.userid,at=userid.lastIndexOf("@");if(at>0&&this.autopad.lastIndexOf(userid.substr(at+1))<0)return void this.drawLoginForm()}""!=this.autoRedirectUrl?PassportSC.gotohref(this.autoRedirectUrl):this.drawPassportCard()}else this.drawLoginForm()},drawPassportNew:function(a,b,c){if("string"===$.type(a)){if(a=$("#"+a),0==a.size())return!1}else{if("object"!==$.type(a))return;a=$(a)}var d=new Function;d.prototype=this;var e=PassportCardList.length,f=new d,g="array"===$.type(c)?c[0]:[];f.successCalledFunc="function"===g?g:"object"===$.type(c)&&c.sufun?c.sufun:!1,f.appid="number"===$.type(b)?b:"object"===$.type(c)&&c.appid?c.appid:9999,f.curCardIndex=e,f.isSetFocus=!1,PassportCardList[e]=f;var h=[e,a];if(h.push(c),"function"===$.type(b))b.apply(this,h||[]);else try{window.drawPassportNewInit(e,a)}catch(i){window.console&&console.info(i)}}};if("undefined"==typeof PP_SETCROSSDOMAIN){var ele=$("head");PassportSC.doCrossDomainCookie(ele,"login"),PassportSC.doCrossDomainCookie(ele,"logout")}return"undefined"==typeof encodeURIComponent&&(PassportSC.usePost=1),3==$.getBrowserType()&&(5e3==screen.height||window.navigator.userAgent.lastIndexOf("Mini")>=0)&&(PassportSC.usePost=1),PassportSC});