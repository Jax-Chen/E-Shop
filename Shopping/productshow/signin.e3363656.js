/*! trade */
define(["jquery","Keeper","passport","dialogs","dialogPP","deal_statistics"],function(a,b,c){function d(c){try{var d=b.cookie("__utma"),e={hiveid:""+d.split(".")[1]+d.split(".")[2],userid:b.login()?b.login().uid.replace("u",""):"",date:(new Date).getTime(),clickkey:c},f=document.createElement("img"),g=[],h=1===e.src?"http://analysis.tuanimg.com/panda/panda_v0.gif?":"http://analysis.tuanimg.com/click_v0.gif?";a.each(e,function(a,b){"src"!==a&&g.push(a+"="+b)}),f.src=h+g.join("&"),f.onload=function(){a(this).remove()},document.body.appendChild(f)}catch(i){}}a.fn.extend({marquee:function(b){function c(){k.append(k.html())}function d(a,b,c){return setInterval(function(){try{var c=+/\-?\d+/.exec(a.css(b))[0];if(-g>=c)return void a.css(b,0);a.css(b,c-1)}catch(d){}},c)}var e,f,g,h,i=a.extend({container:"ul",item:"li",type:" default",pause:!0,fps:18},b),j=this,k=j.find(i.container),l=j.find(i.item),m=l.length,n=l.outerWidth(!0),o=l.outerHeight(!0),p=1e3/i.fps;return"vertical"===i.type?(e="height",f="marginTop",g=o*m):(e="width",f="marginLeft",g=n*m),c(),h=d(k,f,p),i.pause&&k.bind("mouseenter.marquee",function(){clearInterval(h)}).bind("mouseleave",function(){h=d(k,f,p)}),j.killInterval=function(){clearInterval(h)},j}}),a("#signinid").hover(function(){a(this).addClass("open").find(".dropdown-menu").show()},function(){a(this).removeClass("open").find(".dropdown-menu").hide()}),b("signin",{signinQueue:[],unLoginPanelAdData:null,loginPanelAdData:null,animateArray:[],init:function(c){var d=this,e=a("#signinid").data("qq-g-num")||"",f=a("#signinid").data("qq-g-label")||"";Keeper.headQueue.push(this.action),d.getPanelAdData(),Keeper.opts.user=Keeper.opts.user||{},Keeper.opts.user.checkin_status=Keeper.opts.user.checkin_status||{},b.opts.user.login_stauts=b.opts.user.login_stauts||{};var g=function(){var a=this;a.hasClass("sign_panel")?a.find(".gotuan").before('<p class="addQQ">'+f+"<span>"+e+"</span></p>"):a.hasClass("sign_board")&&a.find(".ft .article").append("<p>"+f+"<em>"+e+"</em></p>"),a.data("qqgroup",!0)},h={type:!!Keeper.cookie("ppinf"),addtion:a("#signinid").data("qqgroup")?!1:g,callback:function(){a("#signinid a.signin,.side_panel .signin").unbind("click").bind("click",function(c,d){if(c.preventDefault(),a(this).is("a.signin")){var e=b("deal_statistics");"qiandao_banner"===d?e.pic_stat("qiandao_banner"):"undefined"==typeof d&&e.pic_stat("qiandao_top")}return Keeper.cookie("ppinf")?!1:(a(this).data("click-show-dialog","1"),b("dialogPP").init({id:"dialog_log_qiandao",cls:"dialog_log_qiandao",appid:3105}),Keeper.headQueue.push(function(){setTimeout(function(){a("#signinid a.signin").trigger("click")},1e3)}),!1)})}};this.createPanel(h)},getPanelAdData:function(){function b(a){Keeper.opts.is_getting_checkin_data=!1,Keeper.opts.is_got_checkin_data=!0,Keeper.opts.checkin_cache_data=a,i.loginPanelAdData=a}var c=new Date,d=c.getFullYear(),e=c.getMonth(),f=c.getDate(),g=new Date(d,e,1),h=g.getDay(),i=this,j="http://www.zhe800.com/cn/checkin_info";return Keeper.opts.is_getting_checkin_data||(Keeper.opts.is_got_checkin_data?b(Keeper.opts.checkin_cache_data):(Keeper.opts.is_getting_checkin_data=!0,a.ajax({url:j,type:"GET",dataType:"JSONP",jsonpCallback:"get_pannel_checkin_info",jsonp:"callback",success:b}))),f+h},calendar:function(c){var d=this,e=new Date,f=e.getFullYear(),g=e.getMonth(),h=e.getDate(),i=new Date(f,g,1),j=i.getDay(),k=new Date(new Date(f,g+1,1).getTime()-864e5).getDate(),l=new Date(i.getTime()-24*j*3600*1e3),m=j+k,n=h+j-1,o=[],p=new Date(f,g,1),q=new Date(new Date(f,g+1,1).getTime()-864e5),r=p.getMonth()+1,s=q.getMonth()+1;if("days"===c)return e.getDate()+j;"array"===a.type(c)&&(o=c);var t=new b.Buffers;t.push('<div class="tit"><div class="now_year">'+f+'/</div><div class="now_month">'+(g+1)+"/"+h+'</div></div><table class="calendar"><tr><th class="weekend">日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th class="weekend">六</th></tr>'),t.push("<tr>");for(var u=0;42>u;u++)t.push("<td "+("1"==o[u]||"2"==o[u]&&u>=j&&m>u?' class="qd_calendar'+u+" on "+f+"-"+(10>g+1?"0"+(g+1):g+1)+"-"+(l.getDate()<10?"0"+l.getDate():l.getDate())+'"':j>u||u>=m?" class='disable' ":"class='qd_calendar"+u+" "+f+"-"+(10>g+1?"0"+(g+1):g+1)+"-"+(l.getDate()<10?"0"+l.getDate():l.getDate())+"'")+">"+l.getDate()+(u==n&&u>=j&&m>u?"<a href='javascript:void(0)' class='get_nowaday'></a></td>":"</td>")),l=new Date(l.getTime()+864e5),(u+1)%7===0&&t.push("</tr><tr>");t.push("</tr>"),t.push("</table>");var p=p.getFullYear()+"-"+r+"-"+p.getDate(),q=q.getFullYear()+"-"+s+"-"+q.getDate(),v="http://www.zhe800.com/apicenter/ajax_api_cached/checkin_activity?login_status=1&start_time=%27"+p+"%27&end_time=%27"+q+"%27";return a.ajax({url:v,type:"GET",dataType:"JSONP",jsonpCallback:"checkin_activity",success:function(b){d.loginPanelAdData=b;var c,e=b.calendar;for(c in e)e.hasOwnProperty(c)&&e[c]&&a("."+c).append("<div class='hdqd'><p>"+e[c]+"</p></div>")}}),t.toString()},signQueue:new Keeper.Buffers("queue"),sideAd:function(a){var b='<a href="{{#src}}" title="{{#src_desc}}" target="{{#target}}"><img src="{{#image_src}}" alt="{{#image_desc}}" /></a>';return a?(a.src||(b='<img src="{{#image_src}}" alt="{{#image_desc}}" />'),Keeper.ParseTpl(b,a)):'<div class="tit">小贴士</div><div class="con"><h3>折800商品的更新时间：</h3><p>折800每天更新两次。<br />上午9点，更新近千款；<br />晚上20点，更新百款左右；</p><i class="icon_ft"></i></div>'},createPanel:function(c){function d(){var b=e.loginPanelAdData;if(!b)return void setTimeout(function(){d()},100);var c=a(".side-panel .sign_panel"),f=c.find(".signin");return c.length&&f.length?void(1===b.text.length?(c.css({height:"42px",lineHeight:"42px"}),f.html(b.text[0])):2===b.text.length?(c.css({height:"32px",paddingTop:"5px",paddingBottom:"5px",lineHeight:"16px"}),f.html(b.text.join("<br/>"))):(c.css({height:"32px",paddingTop:"5px",paddingBottom:"5px",lineHeight:"16px"}),f.html("积分掉了<br/>快捡起来"))):void setTimeout(d,100)}var e=this,f=new Date;f.getDate(),f.getMonth();a.each(this.animateArray,function(){this.killInterval&&this.killInterval()});var g=a.extend({type:!1,container:a("#signinid"),return_to:a("#signinid").attr("return_to")||"http://www.zhe800.com/login",addtion:null,callback:null,data:null},c),h=g.container instanceof jQuery?g.container:jQuery(g.container),i=({text:h.data("side-text"),link:h.data("side-link")},new b.Buffers),e=this;b("sidePanel");if(g.type===!1)h.hasClass("sign_board")&&h.removeClass("sign_board").addClass("sign_panel"),h.hasClass("signin_on")&&h.removeClass("signin_on"),i.push('<a class="signin qdicon" href="'+g.return_to+'"></a>'),i.push('<div class="dropdown-menu">'),i.push('<div class="activity"></div>'),h.empty().html(i.toString()),e.unLoginPanelAdData?e.createUnLogininPanelAd():a.ajax({url:"http://www.zhe800.com/right_sign_words/get_not_checkin_info",type:"get",dataType:"jsonp",jsonpCallback:"checkin_activity_success_jsonpCallback",jsonp:"callback",success:function(a){e.unLoginPanelAdData=a,e.createUnLogininPanelAd()}}),function(){var c=b.cookie("qds");"1"==c&&a("#signinid").removeClass("unclick").addClass("unclick")}();else{var j=(g.data,new Date);j.getMonth(),new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");switch(g.type){case"1":i.push('<a href="javascript:void(0)" class="signin qdicon" id="dlqd"></a>'),i.push('<div class="dropdown-menu"><div class="title_user_status"><div class="title_user_status_l"><span class="user_jifen"><span>'+b.opts.user.score+'</span><b>分</b><u>购物可抵<em></em></u><a class="jfhhl" href="http://jifen.zhe800.com/profile/welfare.html?utm_content=qiandao" target="_blank">积分换好礼&gt;</a></span></div><div class="title_user_status_r"><button class="checked_btn'+b.opts.user.checkin_status.tomorrow_score+'"></button></div></div><div class="sign_tog_wrap"><div class="cal_box"><div class="qiandao_huodong"></div><div class="qiandao_renwu"><ul></ul></div></div><div class="qr_box undis"><div class="article"><div class="qr_content"><p>为你的签到升个级吧~</p><a href="javascript:;"><img src="http://i4.tuanimg.com/shop/asset/d/sidepanel/109150_qrcode.png"></a></div></div><div class="ad_signin"><h2 class="qr_tit">手机签到好处多</h2><ul class="qr_list"><li><span>额外积分</span></li><li><span>签到提醒</span></li><li><span>断签复活</span></li><li><span>动指秒签</span></li><li><span>随时随地</span></li></ul></div><a href="javascript:;" class="btn_qr_icon"></a></div></div></div>'),h.hasClass("sign_panel")&&h.removeClass("sign_panel").addClass("sign_board"),h.removeClass("sign_board_unchecked"),h.hasClass("signin_on")||h.addClass("signin_on"),h.empty().html(i.toString()),e.createCheckinPage(),h.find(".ft a").each(function(){var b=a(this);/\>\>$/.test(b.text())||b.text(b.text()+">>")}),e.createUncheckPanelAd(),function(){var c=b.cookie("qds");"1"==c&&a("#signinid").removeClass("unclick")}(),e.appNewUserAd();break;case"0":i.push('<a href="javascript:void(0)" class="signin qdicon signin_unchecked" id="dlqd"></a>'),i.push('<div class="dropdown-menu"><div class="title_user_status"><div class="title_user_status_l"><span class="user_jifen"><span>'+b.opts.user.score+'</span><b>分</b><u>购物可抵<em></em></u><a class="jfhhl" href="http://jifen.zhe800.com/profile/welfare.html?utm_content=qiandao" target="_blank">积分换好礼&gt;</a></span></div><div class="title_user_status_r"><button class="unchecked_btn unchecked_btn'+b.opts.user.checkin_status.current_score+'"></button></div></div><div class="sign_tog_wrap"><div class="cal_box"><div class="qiandao_huodong"></div><div class="qiandao_renwu"><ul></ul></div></div><div class="qr_box undis"><div class="article"><div class="qr_content"><p>为你的签到升个级吧~</p><a href="javascript:;"><img src="http://i4.tuanimg.com/shop/asset/d/sidepanel/109150_qrcode.png"></a></div></div><div class="ad_signin"><h2 class="qr_tit">手机签到好处多</h2><ul class="qr_list"><li><span>额外积分</span></li><li><span>签到提醒</span></li><li><span>断签复活</span></li><li><span>动指秒签</span></li><li><span>随时随地</span></li></ul></div><a href="javascript:;" class="btn_qr_icon"></a></div></div></div>'),h.hasClass("sign_panel")&&h.removeClass("sign_panel").addClass("sign_board sign_board_unchecked"),h.hasClass("signin_on")||h.addClass("signin_on"),h.empty().html(i.toString()),e.createUncheckinPage(),h.find(".ft a").each(function(){var b=a(this);/\>\>$/.test(b.text())||b.text(b.text()+">>")}),e.createUncheckPanelAd(),function(){var c=b.cookie("qds");"1"==c&&a("#signinid").removeClass("unclick").addClass("unclick")}(),e.appNewUserAd()}}if(g.type!==!1&&d(),function(){var c=b.cookie("myqd");a("#signinid");"1"==c&&(a("#signinid .qdicon").addClass("qdyet"),a(".side-tab-checkin").addClass("checkyet"))}(),g.container.data("status",g.type),g.callback)try{g.callback.call(g.container,null)}catch(k){console&&console.log(k)}g.addtion&&e.signQueue.push(g.addtion),a.each(e.signQueue.toArray(),function(b,c){"function"===a.type(c)&&c.call(g.container,null)})},appNewUserAd:function(){var c="http://zapi.zhe800.com/cn/n/user_transfer/authorize?user_id=",d=Keeper.login().uid.replace(/^u/g,"");if("1"===b.cookie("newauser")){var e=a(".sign_tog_wrap .cal_box .qiandao_renwu");e.append('<a class="btn_cal_icon" href="javascript:;"></a>'),a(".btn_cal_icon").on("click",function(){var b=a(this).parents(".sign_tog_wrap").find(".cal_box"),c=a(this).parents(".sign_tog_wrap").find(".qr_box");b.css("display","none"),c.css("display","block")}),a(".btn_qr_icon").on("click",function(){var b=a(this).parents(".sign_tog_wrap").find(".cal_box"),c=a(this).parents(".sign_tog_wrap").find(".qr_box");b.css("display","block"),c.css("display","none")})}else"0"!==b.cookie("newauser")&&a.ajax({url:c+d,type:"GET",dataType:"jsonp",jsonp:"callback",success:function(c){if(0===c.code&&2===c.response){b.cookie("newauser",1,{path:"/",expires:3,domain:".zhe800.com"});var d=a(".sign_tog_wrap .cal_box .article");d.append('<a class="btn_cal_icon" href="javascript:;"></a>');var e=a("#head_nav .sign_tog_wrap .article");e.on("click",".btn_cal_icon",function(){var b=a(this).parents(".sign_tog_wrap").find(".cal_box"),c=a(this).parents(".sign_tog_wrap").find(".qr_box");b.css("display","none"),c.css("display","block")}),e.on("click",".btn_qr_icon",function(){var b=a(this).parents(".sign_tog_wrap").find(".cal_box"),c=a(this).parents(".sign_tog_wrap").find(".qr_box");b.css("display","block"),c.css("display","none")})}else c.response&&2!==c.response&&b.cookie("newauser",0,{path:"/",expires:3,domain:".zhe800.com"})}})},createUncheckinPage:function(){var c=b.opts.user.checkin_status.day,d=(b.opts.user.checkin_status.current_score,new b.Buffers);d.push('<div class="checkin_time_line"><ul>');var e=0;if(3>c)for(e=0;5>e;e++)e==c?d.push('<li class="uncheckin_today_line"><div><span></span></div><p>今天</p></li>'):4!==e?d.push("<li><div><span></span></div><p><span>"+(e+1)+"</span>天</p></li>"):d.push('<li class="last_time_line"><div><span></span></div><p><span>'+(e+1)+"</span>天</p></li>");else for(e=0;5>e;e++)3==e?d.push('<li class="uncheckin_today_line"><div><span></span></div><p>今天</p></li>'):4!==e?d.push("<li><div><span></span></div><p><span>"+(c-2+e)+"</span>天</p></li>"):d.push('<li class="last_time_line"><div><span></span></div><p><span>'+(c-2+e)+"</span>天</p></li>");d.push("</ul></div>"),a(".title_user_status > .title_user_status_l").append(d.toString());var f=[],g=a("#head_nav .checkin_time_line li");f=5>c?[1,2,3,3,3]:5===c?[2,3,3,3,3]:[3,3,3,3,3],g.each(function(b){a(this).children("div").find("span").text("+"+f[b]),b>c&&a(this).addClass("right_time_line")}),a(".title_user_status .unchecked_btn, .uncheckin_today_line > div > span").on("click",function(){a(this).is(".unchecked_btn")?a("#signinid a.signin").trigger("click","qiandao_button"):a("#signinid a.signin").trigger("click","qiandao_lianxu")})},createCheckinPage:function(){var c=b.opts.user.checkin_status.day,d=(b.opts.user.checkin_status.current_score,new b.Buffers);d.push('<div class="checkin_time_line"><ul>');var e=0;if(4>c)for(e=0;5>e;e++)e==c-1?d.push('<li class="checkin_today_line"><div><span></span></div><p>今天</p></li>'):4!==e?d.push("<li><div><span></span></div><p><span>"+(e+1)+"</span>天</p></li>"):d.push('<li class="last_time_line"><div><span></span></div><p><span>'+(e+1)+"</span>天</p></li>");else for(e=0;5>e;e++)3==e?d.push('<li class="checkin_today_line"><div><span></span></div><p>今天</p></li>'):4!==e?d.push("<li><div><span></span></div><p><span>"+(c-3+e)+"</span>天</p></li>"):d.push('<li class="last_time_line"><div><span></span></div><p><span>'+(c-3+e)+"</span>天</p></li>");d.push("</ul></div>"),a(".title_user_status > .title_user_status_l").append(d.toString());var f=[],g=a("#head_nav .checkin_time_line li");f=5>c?[1,2,3,3,3]:5===c?[2,3,3,3,3]:[3,3,3,3,3],g.each(function(b){a(this).children("div").find("span").text("+"+f[b]),b>c-1&&a(this).addClass("right_time_line")})},createUnLogininPanelAd:function(){function b(){var c=a(".side-panel .sign_panel"),e=c.find(".signin");return c.length&&e.length?void(1===d.text.length?(c.css({height:"42px",lineHeight:"42px"}),e.html(d.text[0])):2===d.text.length?(c.css({height:"32px",paddingTop:"5px",paddingBottom:"5px",lineHeight:"16px"}),e.html(d.text.join("<br/>"))):(c.css({height:"32px",paddingTop:"5px",paddingBottom:"5px",lineHeight:"16px"}),e.html("抵现又换礼<br/>积分超实用"))):void setTimeout(b,100)}var c=this;if(!c.unLoginPanelAdData)return void setTimeout(function(){c.createUnLogininPanelAd()},100);var d=c.unLoginPanelAdData,e='<img src="'+d.adv.image_url+'"></img>';a(".dropdown-menu .activity").html(e).on("click",function(){a("#signinid a.signin").trigger("click","qiandao_banner")}),b()},createUncheckPanelAd:function(){var c=this;if(!c.loginPanelAdData)return void setTimeout(function(){c.createUncheckPanelAd()},100);var d=this.loginPanelAdData,e=d.adv,f=(d.text,d.tasks),g=f.length,h=new b.Buffers;a(".sign_tog_wrap .qiandao_huodong").append('<a href="'+e.image1.link_url+'" targrt="'+e.image1.link_type+'"><img src="'+e.image1.image_url+'"/></a><a href="'+e.image2.link_url+'" targrt="'+e.image2.link_type+'"><img src="'+e.image2.image_url+'"/></a><a href="'+e.image3.link_url+'" targrt="'+e.image3.link_type+'"><img src="'+e.image3.image_url+'"/></a>');for(var i=0;g>i;i++)1!==f[i].score_tasks_type_id||-1===f[i].name.indexOf("签到")?f[i].score_no_limit?h.push('<li><a href="'+f[i].url+'" target="_blank"><img src="'+f[i].image_url+'"/><p>'+f[i].name+"<span>无上限</span></p></a></li>"):h.push('<li><a href="'+f[i].url+'" target="_blank"><img src="'+f[i].image_url+'"/><p>'+f[i].name+"<span>+"+f[i].scores+"分</span></p></a></li>"):b.opts.user.checkin_status.status?h.push('<li class="meiri_wrap"><a class="meiri_qiandao"><img src="'+f[i].image_url+'"/><p>'+f[i].name+"<span>+"+f[i].scores+'分</span></p><em class="complete"></em></a></li>'):h.push('<li class="meiri_wrap"><a class="meiri_qiandao"><img src="'+f[i].image_url+'"/><p>'+f[i].name+"<span>+"+f[i].scores+"分</span></p></a></li>");a(".sign_tog_wrap .qiandao_renwu > ul").append(h.toString()),a(".title_user_status .user_jifen em").html(b.opts.user.checkin_status.cash+"元"),a(".qiandao_renwu .meiri_qiandao").on("click",function(){a("#signinid a.signin").trigger("click","qiandao_task")})},cookfunc:function(c){if(!Keeper.cookie("ppinf"))return!1;var d=(a("#signinid"),a("#signinid").data("qq-g-num")||"",a("#signinid").data("qq-g-label")||"",Keeper.cookie("qd"));qd_data=d.split("-");var e=qd_data[0],f=(qd_data[2],qd_data[1]||0),g=a("#signinid").length>0?a("#signinid").attr("info").split("-"):"1-2-3".split("-"),h=(g[2],g[0]),i=g[0],j=g[0];f>0&&3>f&&(h=g[f],i=g[f-1],j=g[f]),f>=3&&(h=g[2],i=g[2],j=g[2]);var k=a("#signinid");switch(c.current_score&&c.tomorrow_score&&(h=i=c.current_score,j=c.tomorrow_score,k.attr("qdscore")||k.attr("qdscore",c.current_score+"-"+c.tomorrow_score)),e){case"0":this.createPanel({type:e,data:c,callback:function(){var d=Keeper.login().idss.id2;0==d&&Keeper.opts.user.login_stauts.ck_times<=3?(a("#signinid").data("bindphone",!0).on("click",".signin",function(){Keeper("bindPhoneMod").init()}),a("body").on("click",".side_panel .signin,.dropdown-menu .activ1,.dropdown-menu .activ2,.dropdown-menu .more_jifen,.calendar .get_nowaday",function(){Keeper("bindPhoneMod").init()})):setTimeout(function(){a("#signinid .signin,.side_panel .signin,.dropdown-menu .activ1,.dropdown-menu .activ2,.dropdown-menu .more_jifen,.calendar .get_nowaday").unbind("click").click(function(d,e){var f=b("deal_statistics");a(this).is("a.signin")&&("qiandao_button"===e?f.pic_stat("qiandao_button"):"qiandao_lianxu"===e?f.pic_stat("qiandao_lianxu"):"qiandao_task"===e?f.pic_stat("qiandao_task"):"undefined"==typeof e&&f.pic_stat("qiandao_top")),a.qdpost("/cn/checkin?checkin=1",c,a(this)),a(".hdts").remove()})},200)}});break;case"1":this.createPanel({type:e,data:c,callback:function(){a("#signinid .signin,.side_panel .signin").unbind("click")}})}},action:function(){var c=(new Keeper.Buffers,Keeper.cookie("outoverlay"));a("#head_nav .tooltip .close").trigger("click");var d=Keeper.opts.user.checkin_status||{};Keeper("signin").cookfunc(d),setTimeout(function(){(1!=d.is_double||c&&"false"!=c||2!=d.status)&&(2==d.status||c&&"false"!=c||1!=d.is_double||0!=d.channels.web||0!=d.channels.mobile)&&1==d.is_double&&1==d.channels.web&&b.login()&&b.login().idss&&0==b.login().idss.id2&&Keeper("bindPhoneMod").init()},200)},Queue:function(){Keeper.cookie("ppinf")||Keeper.cookie("qd","",{path:"/",expires:-336,domain:"zhe800.com"})},Init:function(){}}),a.qdpost=function(c,d,e,f){if(a("#signinid").data("bindphone"))return!1;var g=Keeper("signin"),h=Keeper("bindEmailPop");a.post(c,function(f){function i(a){var b=new Date(new Date((new Date).getTime()+864e5).setHours(0,0,0,0)),c=b.toGMTString(),d="/",e="zhe800.com";document.cookie=a+"=1;expires="+c+";path="+d+";domain="+e}var j=f.status,k=f.score,l=f.day,m=a("#signinid").length>0?a("#signinid").attr("info").split("-"):"1-2-3".split("-"),n=(m[2],m[0]),o=m[0],p=m[0];a("#signinid").data("qq-g-num")||"",a("#signinid").data("qq-g-label")||"";if(5==j){var q=Keeper.cookie("qd").split("-");l=q[1],k=q[2]}l>0&&3>l&&(n=m[l],o=m[l-1],p=m[l]),l>=3&&(n=m[2],o=m[2],p=m[2]);var r=a("#signinid");if(d)d.current_score&&d.tomorrow_score&&(n=o=d.current_score,p=d.tomorrow_score);else if(r.attr("qdscore")){var s=r.attr("qdscore").split("-");n=o=s[0],p=s[1]}var t="签到失败，请重新签到",u='请<a class="font3399cc"target="_blank" href="#">激活</a>您的账户后再来签到！',v="为避免刷小号现象，即日起<br/>每台电脑仅允许一个账号进行签到！";switch(j){case-1:if(g.createPanel({type:"0"}),-1!=c.indexOf("?checkin=1")){Keeper.opts;a.Dialog({id:"dialog_empty_deal",cls:"diglog-wrapper-ad",offset:{top:a("#signinid").offset().top+45,left:a("#signinid").offset().left-175},msg:u,overlay:!0,auto:!1}),a("#dialog_empty_deal .diginfo a").attr("href",f.url),a("#dialog_empty_deal .diginfo a").click(function(){a("#dialog_empty_deal .close").trigger("click")})}break;case 0:g.createPanel({type:!1}),a("a.signin_a,a.cnlogin").click(function(){return self.callfun(),!1});break;case 1:Keeper.opts.user.score=f.score,Keeper.opts.user.checkin_status.status=1,Keeper.opts.user.checkin_status.channels.web=1,Keeper.opts.user.checkin_status.day=f.day,Keeper.opts.user.checkin_status.cash=f.cash,window._gaq?("1"!==a(".side_panel .side-tab-checkin").data("popMark")&&a("#head_nav a.signin").trigger("mouseenter"),e&&e.parents(".side_panel").length?_gaq.push(["_trackPageview","/PageAction/daohang/bottom/Signin"]):e&&e.parents(".head_nav").length&&(_gaq.push(["_trackPageview","/PageAction/daohang/top/Signin"]),e.trigger("mouseenter"))):e&&e.parents(".personalinfo").length,a("#signinid").find(".signin_a").remove().end().prepend('<span class="signin_a"></span>');var w=parseInt(a("#signinid dl dt strong").html());if(a("#signinid dl dt span").html(l),k>w){var x=function(){k>w?(w++,a("#signinid dl dt strong").html(w)):window.clearInterval(a.getTime.countTimer.qdjfadd)};a.getTime.countTimer.qdjfadd=window.setInterval(x,100)}if(Keeper.opts.user&&Keeper.opts.user.checkin_status&&Keeper.opts.user.checkin_status.sign_info){var s=Keeper.opts.user.checkin_status.sign_info;s[s.length-1]="1"}g.createPanel({type:"1",data:f}),f.email_tip&&h.create(),1==f.is_double&&1==f.channels.mobile&&1==f.channels.web&&(Keeper.cookie("signed",!0,{path:"/",expires:1,domain:"zhe800.com"}),a.Dialogs({id:"dialog_empty_deal",cls:"dialog-wrapper-ad",offset:{top:a("#signinid").offset().top+45,left:a("#signinid").offset().left-135},msg:"获取双倍分成功！",auto:5})),Keeper.headQueue.push(function(){Keeper("signin").signinQueue}),Keeper("toolbar_user")&&Keeper("toolbar_user").init();var y=Keeper.opts.user.checkin_status;a(".r_con").append('<div class="show_jifen" id="xsjf"><div class="word_jifen"><p>+<em>'+y.current_score+"</em>积分</p></div><span></span></div>"),a("#xsjf").animate({position:"absolute",top:"-64px",left:"154px",opacity:"0"},1200);var z=new Date(2014,11,26),A=new Date(2015,0,3),B=new Date;if(B.getTime()>=z.getTime()&&B.getTime()<=A.getTime()){var C={26:7,27:6,28:5,29:4,30:3,31:2,1:1,2:0},D={26:141226,27:141227,28:141228,29:141229,30:141230,31:141231,1:150101,2:150102},E=new b.Buffers;E.append('<div><img style="display:block;" src="http://i4.tuanimg.com/shop/asset/d/qd_bg3.png" /><a target="_blank" href="http://www.zhe800.com/jifen/play_activity/zp'+D[B.getDate()]+'" class="sdcj_qcj"></a><p class="sdcj_word">接下来的 <em>'+C[B.getDate()]+"</em> 天，每天签到</br>得更多抽奖机会</p></div>"),a.Dialogs({id:"dialog_tishi_sdcj",cls:"dialog-wrapper sdcj",msg:E.toString(),auto:!1,closebtn:"span.close",overlay:!0}),2==B.getDate()&&a("#dialog_tishi_sdcj .sdcj_word").hide(),a(".sdcj_qcj, #dialog_tishi_sdcj .close").click(function(){a("#dialog_tishi_sdcj").remove(),a(".dialog-overlay").remove()})}i("myqd"),a(".side-tab-checkin").addClass("checkyet"),a("#signinid .qdicon").addClass("qdyet");break;case 2:g.createPanel({type:"0"});Keeper.opts;a.Dialogs({id:"dialog_empty_deal",cls:"dialog-wrapper-ad",offset:{top:a("#signinid").offset().top+45,left:a("#signinid").offset().left-135},msg:t,auto:!1});break;case 3:g.createPanel({type:"1"});break;case 4:g.createPanel({type:"0"});break;case 5:a(".side_panel .side-tab-checkin").removeData("popMark");Keeper.opts;a("#signinid").removeClass("unclick").addClass("unclick"),0!=a("#dialog_empty_deal").size()&&a("#dialog_empty_deal").is(":visible")||a.Dialogs({id:"dialog_empty_deal",cls:"dialog-wrapper-ad",msg:v,auto:!1});break;default:return a.Dialogs({id:"dialog_empty_deal",cls:"dialog-wrapper-ad",msg:t,auto:!1}),!1}0!=j&&-1!=j&&(1!=j&&3!=j||a("#signinid").addClass("signin_on")),-1!=j&&2!=j&&4!=j&&5!=j||a("#signinid .signin,.side_panel .signin").unbind("click").click(function(){a.qdpost("/cn/checkin?checkin=1",d,a(this))})})},b("bindPhoneMod",{picture:function(){c.getCaptcha(function(b){a("#dialog_bdsj_bangding .item .pic_valide").attr("src",login_error_result.captcha_img),a("#dialog_bdsj_bangding .item .pic_valide").attr("token",login_error_result.captcha_keywords)})},bindPhoneTpl:function(){var a=new b.Buffers,c="为了保障您的账户和积分安全，请绑定您的手机！",d=Keeper.opts.user.login_stauts.ck_times;if(a.append('<div class="bangdtit">'),0===d)c="为了继续签到，请填写您的手机号完成安全验证";else{var e=Keeper.login().regt;0==e?c="绑定手机更安全！立刻就得5积分！":1==e&&(c="您还未绑定手机，快来绑定吧！完成绑定后登录折800更方便。")}return a.append("<h3>"+c+"</h3>"),a.append("</div>"),a.append('<div class="reg_box clear">'),a.append('<div class="item">'),a.append('<label>手机号：</label><input type="text" class="itext1" id="mobil">'),a.append("</div>"),a.append('<div class="item pic_valid">'),a.append('<label>图片验证码：</label><input type="text" class="pic_value" id="pic_val">'),a.append('<img class="pic_valide"/>'),a.append('<span class="noclear"><a href="javascript:;">换一张</a></span>'),a.append("</div>"),a.append('<div class="item i_code">'),a.append("<label>短信验证码：</label>"),a.append('<input type="text" class="itext2" id="validCodeP">'),a.append('<span class="i_codeP"><a class="send-idf" href="javascript:void(0);">获取验证码</a></span>'),a.append("</div>"),a.append('<div class="item i_txt">'),a.append('<input type="button" class="tbtn btn" id="reg_submit_i" value="立即验证">'),0!==d&&a.append('<a class="nextbind" href="javascript:void(0)">下次绑定</a>'),a.append("</div>"),a.append("</div>"),a.toString()},bindPhoneSugTpl:function(){var a=new Keeper.Buffers;return a.append('<div class="bangdok">'),a.append("<h3>恭喜，手机号绑定成功。</h3>"),a.append(" </div>"),a.toString()},init:function(b){var c=(Keeper.opts,this);return a("#dialog_bdsj_bangding").length>0?!1:void setTimeout(function(){a.Dialogs({id:"dialog_bdsj_bangding",cls:"closeblock",overlay:!0,msg:c.bindPhoneTpl(),auto:!1}),c.picture(),a("img.pic_valide,span.noclear a").click(function(){c.picture()});var b=a("#reg_submit_i");c.inputEvent(),Keeper.getMobileCode(a(".send-idf"),a("#mobil")),b.unbind().bind("click",function(a){a.preventDefault(),c.Checkout()}),0!==a("a.nextbind").length&&a("a.nextbind").click(function(b){a("#dialog_bdsj_bangding .close").trigger("click"),a.qdpost("/cn/checkin?checkin=1")})},200)},inputEvent:function(){var b=[a("#mobil"),a("#validCodeP"),a("#pic_val")],c=[{focus:function(){a(this).inputWarn("为了您的安全，请确保绑定手机号是您的真实手机",1),a("#reg_submit_i").inputNotip()},blur:function(){a(this).quizMobile()}},{focus:function(){a(this).inputNotip(),a("#reg_submit_i").inputNotip()},blur:function(){a(this).quizVeriCode()}},{focus:function(){a(this).inputNotip(),a("#reg_submit_i").inputNotip()},blur:function(){a(this).picVeriCode()}}];a.each(b,function(a,b){b.live(c[a])})},Checkout:function(){var b=[a("#mobil"),a("#validCodeP")];a.each(b,function(a,b){b.trigger("blur")}),a(".reg_box").find(".msg_zt3")[0]||this.submitForm()},submitForm:function(){var b=this;a(".reg_box .msg_box").remove(),a.getScript("https://passport.tuan800.com/api/bind_mobiles/bind_and_unbind?phone_number="+a("#mobil").val()+"&phone_confirmation="+a("#validCodeP").val(),{callback:function(){var c=window.result||{};switch(c.status){case 200:"yes"==Keeper.opts.user.login_stauts.login&&(a("#reg_submit_i").inputNotip(),a("#dialog_bdsj_bangding .close").trigger("click"),d("registration_bind_phone_succeed"),a.Dialogs({overlay:!0,id:"dialog_bdsj_bangding",cls:"closeblock",msg:b.bindPhoneSugTpl,auto:!0,times:3,closefun:function(){a("#signinid").data("bindphone",!1),a.qdpost("/cn/checkin?checkin=1")}}));break;case 401:return a("#validCodeP").inputError(c.message);case 402:return a("#validCodeP").inputError(c.message);case 10:return a("#validCodeP").inputError(c.message);case 403:return a("#validCodeP").inputError(c.message);case 404:return a("#mobil").inputError(c.message);default:a("#validCodeP").inputNotip()}},cache:"false"})}});var e={tip:function(a,b,c){var d=this.parents(".item").removeClass("msg_zt1 msg_zt2 msg_zt3");this.siblings(".msg_box").remove(),a!==!0&&d.addClass("msg_zt"+a).append('<div class="msg_box row'+c+'"><em></em><span class="msg">'+b+"</span></div>")},isMobile:function(a){if(!a)return 1;var b=Keeper.verification.mobile(a);return 0!=b.status?2:void 0},isPcode:function(a){return a?void 0:1}},f={quizVeriCode:function(){var a=this;a.val()?a.inputNotip():a.inputError("请输入短信验证码")},picVeriCode:function(){var a=this;a.val()?a.inputNotip():a.inputError("请输入图片验证码")},quizMobile:function(){var a=this;switch(e.isMobile(a.val())){case 1:return a.inputError("请输入手机号");case 2:return a.inputError("手机号码格式错误");default:return a.inputCorrect()}}};a.extend(a.fn,{inputWarn:function(a,b){e.tip.call(this,1,a,b||1)},inputError:function(a,b){e.tip.call(this,3,a,b||1)},inputCorrect:function(){e.tip.call(this,2,"",1)},inputNotip:function(){e.tip.call(this,!0)}},f,{sendMobileCode:function(b,c){var c=(a(this),c||new Function),e=a("#pic_val").val(),f=a("img.pic_valide").attr("token");a(".reg_box .msg_box").remove(),a.getScript("https://passport.tuan800.com/api/bind_mobiles/phone_confirmations?phone_number="+a("#mobil").val()+"&captcha="+e+"&captcha_keywords="+f+"&type=force_unbind",{callback:function(){var b=window.result||{};switch(b.status){case 1:d("registration_bind_phone_succeed");break;case 2:return a("#mobil").inputError(b.message),c(b);case 3:return a("#mobil").inputError(b.message),c(b);case 4:return a("#mobil").inputError(b.message),c(b);case 5:return a("#mobil").inputError("该手机号已被占用，您可以使用此手机号直接登录"),c(b);case 10:return a("#validCodeP").inputError(b.message),c(b);case 11:return a("#validCodeP").inputError(b.message),c(b);case 401:return a(".pic_valide").trigger("click"),a("#pic_val").inputError(b.message),c(b);case 402:return a("#pic_val").inputError(b.message),c(b);case 403:return a("#validCodeP").inputError(b.message),c(b);case 200:a("#validCodeP").inputError(b.message),a(".i_code .msg_box em").addClass("win")}},cache:"false"})}}),a.extend(Keeper,{addTimeout:function(a,b,c,d){var e=new Function,f=null;return d=d||e,c=c||e,window.setInterval(function(){return 0===a--?(d.call(window,a),window.clearInterval(f)):void c.call(window,a)},b)},getMobileCode:function(b,c){var d=(new Function,!0),f=null,g=60,h=1e3;a(".send-idf").unbind().bind("click",function(){if(d)switch(c=a("#mobil"),e.isMobile(c.val())){case 1:return c.inputError("请输入手机号");case 2:return c.inputError("手机号码格式错误");default:if(""==a("#pic_val").val())return a("#pic_val").inputError("请输入图片验证码");f=Keeper.addTimeout(g,h,function(b){a(".send-idf").html(""+(10>b?"0".concat(b):b)+"秒后重新发送").css({cursor:"default","background-position":"0 -208px"}),a(".reg_box .item .i_codeP a").css("width","120px"),d=!1},function(){clearInterval(f),d=!0,counter=g,a(".send-idf").html("获取验证码").css({cursor:"pointer","background-position":"0 -142px"}),a(".reg_box .item .i_codeP a").css("width","84px")}),a("#dialog_bdsj_bangding").find(".close").bind("click",function(){clearInterval(f),d=!0,counter=g,a(".send-idf").html("获取验证码").css({"background-position":"0 -142px"}),a(".reg_box .item .i_codeP a").css("width","84px")}),b.sendMobileCode(c.val(),function(b){clearInterval(f),d=!0,counter=g,a(".send-idf").html("获取验证码").css({"background-position":"0 -142px"}),a(".reg_box .item .i_codeP a").css("width","84px")})}})},getPicPath:function(b){var b=a.extend(!0,{url:"z3.tuanimg.com",source:"main",sellerId:0,id:0,type:"all"},b),c="http://{{#url}}/imagev2/trade/{{#filename}}";if(0==b.sellerId&&0==b.id)return"";var d=(b.id+"").split(".");switch(b.type){case"big":d.splice(d.length-1,0,"400x");break;case"huge":d.splice(d.length-1,0,"980x");
break;case"middle":d.splice(d.length-1,0,"100x100");break;case"small1":d.splice(d.length-1,0,"58x58");break;case"small2":d.splice(d.length-1,0,"50x50");break;case"tiny":d.splice(d.length-1,0,"25x25");break;case"jfgmb":d.splice(d.length-1,0,"600x");break;default:d.splice(d.length-1,0,b.type)}return b.filename=d.join("."),Keeper.ParseTpl(c,b)}})});